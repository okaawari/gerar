# DO NOT REMOVE. CLOUDLINUX PASSENGER CONFIGURATION BEGIN
PassengerAppRoot "/home/gerarmn/api.gerar.mn"
PassengerBaseURI "/"
PassengerNodejs "/home/gerarmn/nodevenv/api.gerar.mn/22/bin/node"
PassengerAppType node
PassengerStartupFile /home/gerarmn/api.gerar.mn/src/server.js
# DO NOT REMOVE. CLOUDLINUX PASSENGER CONFIGURATION END

# php -- BEGIN cPanel-generated handler, do not edit
# Set the "ea-php81" package as the default "PHP" programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php81 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit

# DO NOT REMOVE OR MODIFY. CLOUDLINUX ENV VARS CONFIGURATION BEGIN
<IfModule Litespeed>
</IfModule>
# DO NOT REMOVE OR MODIFY. CLOUDLINUX ENV VARS CONFIGURATION END

# ============================================
# ADDITIONAL CONFIGURATION FOR API
# ============================================

# Allow PUT, PATCH, DELETE methods (for mod_security compatibility)
<Limit PUT PATCH DELETE>
    Require all granted
</Limit>

# Disable mod_security for API routes
# This is necessary because mod_security blocks PUT/PATCH/DELETE requests before they reach Node.js
# Try multiple approaches as different hosting providers use different mod_security versions

# Approach 1: Disable mod_security entirely for this directory (mod_security v1)
<IfModule mod_security.c>
    SecFilterEngine Off
    SecFilterScanPOST Off
    SecFilterScanGET Off
</IfModule>

# Approach 2: Disable mod_security v2/v3 (CloudLinux/WHM/cPanel)
<IfModule mod_security2.c>
    SecRuleEngine Off
</IfModule>

# Approach 3: Remove specific rules that commonly block API methods
# Common rule IDs that block PUT/PATCH/DELETE: 300015, 300016, 300017, 949110, 980130
# Uncomment and adjust based on your mod_security logs:
# <IfModule mod_security2.c>
#     SecRuleRemoveById 300015
#     SecRuleRemoveById 300016
#     SecRuleRemoveById 300017
#     SecRuleRemoveById 949110
#     SecRuleRemoveById 980130
# </IfModule>

# Enable CORS for API endpoints
# Note: Since Passenger handles routing to Node.js, CORS is primarily handled by the Node.js app.
# DO NOT intercept OPTIONS requests - let Passenger pass them to Node.js so the CORS middleware can handle them.
# The Node.js CORS middleware will properly handle preflight OPTIONS requests with the correct origin.

# Don't interfere with Passenger routing
# Passenger handles all routing to the Node.js application
# The rewrite rules below are commented out since Passenger manages this
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{REQUEST_FILENAME} !-f
#     RewriteCond %{REQUEST_FILENAME} !-d
# </IfModule>
